# 师训简易版--小程序互动直播总结 

## trtc-room/IM-sdk/腾云课堂实现小程序互动直播

背景/目标

师训为教师培训平台，互动直播是该平台的核心功能之一。老师使用PC端（采用空中课堂aPaas框架，实现的定制化的空中课堂）进行直播、白板绘制；学生端使用小程序，实现观看直播/白板、连麦互动等功能。本篇内容对小程序学生端实现互动直播进行了总结。

学生端包含主要功能（思维导图）

1.观看老师直播

2.观看上麦/视频的同学直播

3.举手申请上下麦权限/上下麦

4.收发IM消息

5.全屏：观看老师直播/收发展示IM消息



实现路径：

1.TRTC-ROOM实现互动直播https://cloud.tencent.com/document/product/647/17018

2.IM 收发IM消息（文本/图片 + 信令）

3.接入空课，获取课堂信息，加入TRTC房间和IM群组

## TRTC 

https://cloud.tencent.com/document/product/647/17018

### 接入步骤

1. 前提条件：

   (1) 实名认证的腾讯云账号，创建新应用

   (2) 开通小程序类目与推拉流标签权限

    

2. 下载SDK源码https://github.com/tencentyun/TRTCSDK/tree/master/WXMini， 把component目录下的trtc-room文件夹，放进自己项目的component目录下，

3. 在需要引入组件的页面目录下，配置相应页面的 xxx.json 文件。

   ```json
   // xxx.json
   "usingComponents": {
   "trtc-room": "/components/trtc-room/trtc-room"
   }
   ```

   

4. wxml

   ```html
   // xxx.wxml  
   <trtc-room config="{{trtcConfig}}" handStaus="{{handStaus}}" bindhandup="changeHandStatus"  teacherInfo="{{teacherInfo}}"></trtc-room>
   
   注:
   传入属性：
   // handStaus teacherInfo 属性(需要在trtc-room里再引入到使用的模板custom/1V1等，trtc-room.js文件中声明)
   如：
   // trtc-room.wxml
     <block wx:if="{{template === 'custom'}}">
       <template is='custom' data="{{handStaus, }}"></template>
     </block>
   // trtc-room.js
   Component({
     properties: {
   	teacherInfo: {
         type: Object,
         value: {
           Name: null,
           HeadUrl: '',
           UserId: null,
           hasMainVideo: false,
           hasMainAudio: false,
         },
       },
     }
   })
   // custom.wxml使用
   <view class="teacher-name">{{teacherInfo.name}}</view>
   
   传出事件：
   // handup 事件
   // trtc-room.js
   _toggleHandUp() {
     this.triggerEvent('handup');
   },
   //xxx.wxml 见上
   <trtc-room config="{{trtcConfig}}" handStaus="{{handStaus}}" bindhandup="changeHandStatus"  teacherInfo="{{teacherInfo}}"></trtc-room>
   // xxx.js
   changeHandStatus() {
     ...blabla...
   }
   ```

5. js

   1) 获取token/usersig/sdkappid: 早期开发阶段可以使用算法在客户端生成，使用中由后台下发

   2) 设置 trtcConfig

   ```js
   // xxx.js
   this.setData({
    trtcConfig:{
        sdkAppID: '1401000123',  // 开通实时音视频服务创建应用后分配的 SDKAppID
        userID: 'test_user_001', // 用户 ID，可以由您的帐号系统指定
        userSig: 'xxxxxxxxxxxx', // 身份签名，相当于登录密码的作用
        template: 'grid',        // 画面排版模式
    }
   }
   ```

   3) 监听trtc事件

   ```js
   // 绑定trtc事件
     bindTRTCRoomEvent() {
       const TRTC_EVENT = this.trtcComponent.EVENT;
       // 初始化事件订阅
       this.trtcComponent.on(TRTC_EVENT.LOCAL_JOIN, (event) => {
         console.log('[TRTC]LOCAL_JOIN', event);
         // 进房成功，触发该事件后可以对本地视频和音频进行设置
         // if (this.data.role === 'presenter') {
         //   this.trtcComponent.publishLocalAudio()
         // }
       });
       this.trtcComponent.on(TRTC_EVENT.LOCAL_LEAVE, (event) => {
         console.log('[TRTC]LOCAL_LEAVE', event);
       });
       this.trtcComponent.on(TRTC_EVENT.ERROR, (event) => {
         console.log('[TRTC]ERROR', event);
       });
       // 远端用户进房
       this.trtcComponent.on(TRTC_EVENT.REMOTE_USER_JOIN, (event) => {
         console.log('[TRTC]REMOTE_USER_JOIN', event, this.trtcComponent.getRemoteUserList());
         const userList = this.trtcComponent.getRemoteUserList();
         this.handleOnUserList(userList).then(() => {
           console.log(this.data.userList);
         });
       });
       // 远端用户退出
       this.trtcComponent.on(TRTC_EVENT.REMOTE_USER_LEAVE, (event) => {
         console.log('[TRTC]REMOTE_USER_LEAVE', event, this.trtcComponent.getRemoteUserList());
         const userList = this.trtcComponent.getRemoteUserList();
         this.handleOnUserList(userList).then(() => {
           console.log(this.data.userList);
         });
       });
       // 远端用户推送视频
       this.trtcComponent.on(TRTC_EVENT.REMOTE_VIDEO_ADD, (event) => {
         // 订阅（即播放）远端用户的视频流
         if (this.data.userList.length < 6) {
           const { data } = event;
           // 如果不订阅就不会自动播放音频
           const userList = this.trtcComponent.getRemoteUserList();
           this.handleOnUserList(userList).then(() => {
             console.log(this.data.userList);
           });
           console.log('[TRTC]REMOTE_VIDEO_ADD', event, this.trtcComponent.getRemoteUserList());
           this.trtcComponent.subscribeRemoteVideo({ userID: data.userID, streamType: data.streamType });
         }
       });
       // 远端用户推送音频
       this.trtcComponent.on(TRTC_EVENT.REMOTE_AUDIO_ADD, (event) => {
         if (this.data.userList.length < 6) {
           // 订阅音频
           const { data } = event;
           // 如果不订阅就不会自动播放音频
           const userList = this.trtcComponent.getRemoteUserList();
           this.handleOnUserList(userList).then(() => {
             console.log(this.data.userList);
           });
           console.log('[TRTC]REMOTE_AUDIO_ADD', event, this.trtcComponent.getRemoteUserList());
           this.trtcComponent.subscribeRemoteAudio({ userID: data.userID });
         }
       });
       // 远端用户取消推送音频
       this.trtcComponent.on(TRTC_EVENT.REMOTE_AUDIO_REMOVE, (event) => {
         console.log('[TRTC]REMOTE_AUDIO_REMOVE', event, this.trtcComponent.getRemoteUserList());
         const userList = this.trtcComponent.getRemoteUserList();
         this.handleOnUserList(userList).then(() => {
           console.log(this.data.userList);
         });
       });
       // 远端用户取消推送视频
       this.trtcComponent.on(TRTC_EVENT.REMOTE_VIDEO_REMOVE, (event) => {
         console.log('[TRTC]REMOTE_VIDEO_REMOVE', event, this.trtcComponent.getRemoteUserList());
         const userList = this.trtcComponent.getRemoteUserList();
         this.handleOnUserList(userList).then(() => {
           console.log(this.data.userList);
         });
       });
       this.trtcComponent.on(TRTC_EVENT.REMOTE_AUDIO_VOLUME_UPDATE, (event) => {
         const { userID } = event.data.target.dataset;
         const { volume } = event.data.detail;
         this.data.userList.forEach((item) => {
           if (item.userID === userID) {
             item.volume = volume;
           }
         });
         this.setData({
           userList: this.data.userList,
         });
       });
     },
   ```

   

6. custom.wxml trtcConfig中的template设为custom，在custom.wxml里写模板样式

   ```html
   <!-- template custom -->
   <template name='custom'>
     <view class="template-custom {{hiddenOpWrap ? 'hiddenOpWrap' : ''}}" bindtap="tapVideoContainer">
       <!-- 白板流 start -->
       <view class="main-container" wx:if="{{ mainStreamType==='boardStream' &&  boardStream.userID && boardStream.src && (boardStream.hasAudio || boardStream.hasVideo)}}" id="{{'player-'+boardStream.streamID}}" data-userid="{{boardStream.userID}}" data-streamtype="{{boardStream.streamType}}" bindtap="_doubleTabToggleFullscreen">
         <live-player object-fit="contain" class="player" id="{{boardStream.streamID}}" data-userid="{{boardStream.userID}}" data-streamid="{{boardStream.streamID}}" data-streamtype="{{boardStream.streamType}}" src="{{boardStream.src}}" mode="{{boardStream.mode}}" autoplay="{{boardStream.autoplay}}" mute-audio="{{boardStream.muteAudio}}" mute-video="{{boardStream.muteVideo}}" orientation="{{boardStream.orientation}}" background-mute="{{boardStream.enableBackgroundMute}}" min-cache="{{boardStream.minCache}}" max-cache="{{boardStream.maxCache}}" sound-mode="{{boardStream.soundMode}}" enable-recv-message="{{boardStream.enableRecvMessage}}" debug="{{debug}}" bindstatechange="_playerStateChange" bindfullscreenchange="_playerFullscreenChange" bindnetstatus="_playerNetStatus" bindaudiovolumenotify="_playerAudioVolumeNotify"></live-player>
       </view>
       <!-- 白板流 end -->
       <!-- 老师流 start -->
       <view class="{{mainStreamType==='boardStream' ? 'aux-container' : 'main-container flex-middle'}}" wx:if="{{ userInfoMap && teacherStream.userID && teacherStream.src && (teacherStream.hasAudio || teacherStream.hasVideo)}}" id="{{'player-'+teacherStream.streamID}}" data-userid="{{teacherStream.userID}}" data-streamtype="{{teacherStream.streamType}}" bindtap="_doubleTabToggleFullscreen">
         <live-player class="player" id="{{teacherStream.streamID}}" data-userid="{{teacherStream.userID}}" data-streamid="{{teacherStream.streamID}}" data-streamtype="{{mainStreamType === 'boardStream'?'fillCrop':'contain'}}" src="{{teacherStream.src}}" mode="{{teacherStream.mode}}" autoplay="{{teacherStream.autoplay}}" mute-audio="{{teacherStream.muteAudio}}" mute-video="{{teacherStream.muteVideo}}" orientation="{{teacherStream.orientation}}" object-fit="{{mainStreamType === 'boardStream'?'fillCrop':'contain'}}" background-mute="{{teacherStream.enableBackgroundMute}}" min-cache="{{teacherStream.minCache}}" max-cache="{{teacherStream.maxCache}}" sound-mode="{{teacherStream.soundMode}}" enable-recv-message="{{teacherStream.enableRecvMessage}}" debug="{{debug}}" bindstatechange="_playerStateChange" bindfullscreenchange="_playerFullscreenChange" bindnetstatus="_playerNetStatus" bindaudiovolumenotify="_playerAudioVolumeNotify">
           <view class="avatar-container flex-middle" wx:if="{{!teacherStream.hasVideo  && teacherStream.hasAudio}}">
             <image wx:if="{{!teacherStream.hasVideo }}" mode="aspectFill" src="{{userInfoMap[teacherInfo.KkUserId].avatar || '/assets/image/person.png'}}" class="avatar-img" />
           </view>
         </live-player>
         <view class="teacher-tag" wx:if="{{mainStreamType==='boardStream'}}">主讲</view>
       </view>
       <!-- 老师流 end -->
       <!-- 无流 start -->
       <view wx:else class="{{mainStreamType==='boardStream' ? 'aux-container' : 'main-container flex-middle'}}">
         <image wx:if="{{!teacherStream.hasVideo }}" mode="aspectFill" src="{{userInfoMap[teacherInfo.KkUserId].avatar || '/assets/image/person.png'}}" class="avatar-img" />
         <view class="teacher-tag" wx:if="{{mainStreamType==='boardStream'}}">主讲</view>
       </view>
       <!-- 无流 end -->
       <!-- 学生视频位 start -->
       <view class="students-container {{hiddenOpWrap?'hide-op-wrap':''}}" wx:if="{{!classEndFlag}}" hidden="{{videoAllFold ||!presenterConfig.handStatus && permissionNumber < 1 && (!pusher.enableCamera && !pusher.enableMic) &&  (!presenterConfig.micPermission && !presenterConfig.cameraPermission)}}">
         <!-- 连麦流 -->
         <view wx:for="{{permissionStreams}}" wx:key="streamID" class="student-container" id="{{'player-'+ item.user_id}}" wx:if="{{(!hiddenOpWrap && !videoFold) || ((!presenterConfig.micPermission && !presenterConfig.cameraPermission && !presenterConfig.handStatus) && (item.index === permissionNumber-1))}}">
           <view class="student-video-wrap" wx:if="{{(!hiddenOpWrap && !videoFold) || ((!presenterConfig.micPermission && !presenterConfig.cameraPermission && !presenterConfig.handStatus) && (item.index === permissionNumber-1))}}">
             <live-player class="player" wx:if="{{item.hasVideo || item.hasAudio }}" id="{{item.streamID}}" data-userid="{{item.userID}}" data-streamid="{{item.streamID}}" data-streamtype="{{item.streamType}}" src="{{item.src}}" mode="{{item.mode}}" autoplay="{{item.autoplay}}" mute-audio="{{item.muteAudio}}" mute-video="{{item.muteVideo}}" orientation="{{item.orientation}}" object-fit="{{item.objectFit}}" background-mute="{{item.enableBackgroundMute}}" min-cache="{{item.minCache}}" max-cache="{{item.maxCache}}" sound-mode="{{item.soundMode}}" enable-recv-message="{{item.enableRecvMessage}}" debug="{{debug}}" bindstatechange="_playerStateChange" bindfullscreenchange="_playerFullscreenChange" bindnetstatus="_playerNetStatus" bindaudiovolumenotify="_playerAudioVolumeNotify">
             </live-player>
             <image wx:else mode="aspectFill" src="{{userInfoMap[item.userID || item.user_id].avatar || '/assets/image/person.png'}}" class="avatar-img" />
           </view>
         </view>
         <!-- 本地流 -->
         <view class="{{presenterConfig.micPermission || presenterConfig.cameraPermission ?  'student-container' : ''}} " hidden="{{!presenterConfig.micPermission && !presenterConfig.cameraPermission }}" id="{{'player-'+pusher.userID}}" data-userid="{{pusher.userID}}">
           <view class="student-video-wrap">
             <live-pusher class="pusher flex-middle" url="{{pusher.url}}" mode="{{pusher.mode}}" autopush="{{pusher.autopush}}" enable-camera="{{pusher.enableCamera}}" enable-mic="{{pusher.enableMic}}" muted="{{!pusher.enableMic}}" enable-agc="{{pusher.enableAgc}}" enable-ans="{{pusher.enableAns}}" enable-ear-monitor="{{pusher.enableEarMonitor}}" auto-focus="{{pusher.enableAutoFocus}}" zoom="{{pusher.enableZoom}}" min-bitrate="{{pusher.minBitrate}}" max-bitrate="{{pusher.maxBitrate}}" video-width="{{pusher.videoWidth}}" video-height="{{pusher.videoHeight}}" beauty="{{pusher.beautyLevel}}" whiteness="{{pusher.whitenessLevel}}" orientation="{{pusher.videoOrientation}}" aspect="{{pusher.videoAspect}}" device-position="{{pusher.frontCamera}}" remote-mirror="{{pusher.enableRemoteMirror}}" local-mirror="{{pusher.localMirror}}" background-mute="{{pusher.enableBackgroundMute}}" audio-quality="{{pusher.audioQuality}}" audio-volume-type="{{pusher.audioVolumeType}}" audio-reverb-type="{{pusher.audioReverbType}}" waiting-image="{{pusher.waitingImage}}" debug="{{debug}}" bindstatechange="_pusherStateChangeHandler" bindnetstatus="_pusherNetStatusHandler" binderror="_pusherErrorHandler" bindbgmstart="_pusherBGMStartHandler" bindbgmprogress="_pusherBGMProgressHandler" bindbgmcomplete="_pusherBGMCompleteHandler" bindaudiovolumenotify="_pusherAudioVolumeNotify">
             </live-pusher>
         </view>
       </view>
       <!-- 学生视频位 end -->
       <!-- fixed element start -->
       <view class="fixed-wrap" hidden="{{hiddenOpWrap}}">
         <!-- <view class="top-mask"></view>
         <view class="bottom-mask"></view> -->
         <view class="people-summary">{{membersTotal}}人在线</view>
         <view class="full-screen-wrap">
           <image hidden="{{ mainStreamType === 'teacherStream' && !teacherInfo.hasMainAudio && !teacherInfo.hasMainVideo}}" class="full-screen-img" src="/assets/image/lesson/icon-fullscreen.png" data-user-i-d="{{boardStatus ? boardStream.userID : teacherInfo.KkUserId }}" data-stream-type="main" catchtap="_goToLandscape"></image>
         </view>
       </view>
       <!-- fixed element end -->
     </view>
   </template>
   
   ```
   

## 腾云课堂aPaas:

腾讯云课堂 aPaaS 是由腾讯教育在腾讯云基础能力之上构建的一套在线课堂解决方案，方案以 aPaaS 的形式提供服务，以音视频互动为基础提供了一系列在线课堂常用功能。主要面向教育行业具有一定研发能力的企业，提供一套接入简易、功能全面、可用性高的在线授课框架。您仅需要在解决方案基础上进行少量的研发工作，即可快速搭建出一套自己在线课堂 SaaS 服务，向终端客户提供稳定、全面的服务。

接入文档：https://docs.qcloudclass.com/#/Intro

由于在项目开发时，aPaas小程序端sdk尚未开发，因此师训项目老师端直播（Web）使用腾云课堂aPaas方案，而小程序端（学生端）直播模块通过直接或通过师训后台间接调用腾云课堂后台接口来实现，调用了大量内部接口，因此该方案不具有复制价值，但是可以帮助理解如何在小程序端实现直播课堂方案。（现腾云课堂已经推出小程序SDK）



## 即时通信IM

接入IM实现收发聊天消息、互动消息和控制信令。

1.7版本文档：https://github.com/tencentyun/TIMSDK/tree/master/WXMini/v1.7.x

官网文档： https://cloud.tencent.com/document/product/2691

1.下载源码，由于腾云课堂中一个课堂内的用户需要同时加入信令群组和消息群组，而新版本IM不支持同一用户同时加入两个群组，所以采用1.7旧版本IM。1.7版本小程序IM地址：https://github.com/tencentyun/TIMSDK/tree/master/H5/v1.7.x 将sdk文件webim_wx.js。

2.下面在webim_handler.js中对一些常用函数进行封装

```javascript
// 引入 webim
const webim = require('./webim_wx.js');
// const IMListeners = require('./imListener');
const ImHandler = require('./ImHandler');

module.exports = {
  userId: null,
  userNick: null,
  sendMsgFailMap: {},
    /**
   * 登录IM
   */
  login(data, lisenter) {
    return new Promise((resolve, reject) => {
      webim.login(
        {
          sdkAppID: data.sdkAppId, // 用户所属应用id,必填
          appIDAt3rd: data.sdkAppId, // 用户所属应用id，必填
          accountType: 1, // 用户所属应用帐号类型，必填
          identifier: data.userId, // 当前用户ID,必须是否字符串类型，选填
          identifierNick: data.userNick || data.userId,
          userSig: data.userSig,
        },
        lisenter,
        {
          isAccessFormalEnv: true,
          isLogOn: false,
        },
        (res) => {
          this.userId = data.userId;
          this.userNick = data.userNick || data.userId;
          this.headImg = data.headImg || '';
          this.setProfilePortrait({
            nickname: this.userNick,
            headImg: this.headImg,
          });

          ImHandler.userId = data.userId;

          resolve(res);
        },
        (error) => {
          console.error(error);
          reject(error);
        },
        // reject,
      );
    });
  },

  /**
   * 注销IM
   */
  logout(succ, fail) {
    if (webim.checkLogin()) {
      webim.logout(succ, fail);
    }
  },

  setProfilePortrait(userData) {
    console.log('IM setProfilePortrait');
    const profile_item = [
      {
        Tag: 'Tag_Profile_IM_Nick',
        Value: userData.nickname,
      },
    ];

    if (userData.headImg) {
      profile_item.push({
        Tag: 'Tag_Profile_IM_Image',
        Value: userData.headImg,
      });
    }

    const options = {
      ProfileItem: profile_item,
    };

    webim.setProfilePortrait(
      options,
      (resp) => {},
      (err) => {},
    );
  },

  /**
   * 加入IM聊天群
   */
  joinGroup(userId, groupId) {
    // 直接加入群
    return new Promise((resolve, reject) => {
      // this.createGroup(userId, groupId).then(res => {
      // webim.applyJoinGroup({
      webim.applyJoinBigGroup(
        {
          GroupId: groupId,
        },
        (resp) => {
          // JoinedSuccess:加入成功; WaitAdminApproval:等待管理员审批
          if (resp.JoinedStatus && resp.JoinedStatus == 'JoinedSuccess') {
            if (groupId.indexOf('chat') > -1) {
              ImHandler.chatSess = new webim.Session(webim.SESSION_TYPE.GROUP, groupId, groupId);
            } else {
              ImHandler.cmdSess = new webim.Session(webim.SESSION_TYPE.GROUP, groupId, groupId);
            }
            ImHandler.userId = this.userId;
            ImHandler.userNick = this.userNick;
            resolve(resp);
          } else {
            reject(resp);
          }
        },

        (err) => {
          if (err.ErrorCode == 10013 || err.ErrorCode == -12) {
            // 被邀请加入的用户已经是群成员,也表示成功 || Join Group succeed; But the type of group is not AVChatRoom
            if (groupId.indexOf('chat') > -1) {
              ImHandler.chatSess = new webim.Session(webim.SESSION_TYPE.GROUP, groupId, groupId);
            } else {
              ImHandler.cmdSess = new webim.Session(webim.SESSION_TYPE.GROUP, groupId, groupId);
            }
            ImHandler.userId = this.userId;
            ImHandler.userNick = this.userNick;
            resolve(err);
          } else {
            reject(err);
          }
        },
      );
      // }, (err) => {
      //   reject(err);
      // });
    });
  },

  getGroupInfo(groupId) {
    const options = {
      GroupIdList: [groupId + ''],
      GroupBaseInfoFilter: ['Type', 'Name', 'MemberNum', 'MaxMemberNum'],
    };
    return new Promise((resolve, reject) => {
      webim.getGroupInfo(
        options,
        (resp) => {
          console.debug('getGroupPublicInfo => ', resp);
          if (resp && resp.ErrorCode === 0 && resp.GroupInfo && resp.GroupInfo.length > 0) {
            resolve(resp.GroupInfo[0]);
          } else {
            reject(resp);
          }
        },
        (err) => {
          reject(err);
        },
      );
    });
  },

  /**
   * 退出课堂
   * @param {*} succ
   * @param {*} fail
   */
  quitGroup(groupId, succ, fail) {
    webim.quitGroup(
      {
        GroupId: String(groupId),
      },
      () => {
        succ && succ();
      },
      (error) => {
        // 群不存在 或者 不在群里了 或者 群id不合法（一般这种情况是课堂销毁了groupId被重置后发生）
        if (error.ErrorCode === 10010 || error.ErrorCode === 10007 || error.ErrorCode === 10015) {
          succ && succ();
        } else if (error.ErrorCode == 10009) {
          // 群主自己想退课堂
          succ && succ();
        } else {
          fail && fail(error);
        }
      },
    );
  },

  /**
   * 销毁群组
   */
  destroyGroup(classId, succ, fail) {
    webim.destroyGroup(
      {
        GroupId: `${classId}`,
      },
      (resp) => {
        succ && succ();
      },
      (err) => {
        fail && fail(err);
      },
    );
  },

  /**
   * 发送C2C文本消息
   */
  sendC2CTextMessage(toUserIdentifier, msg, succ, fail) {
    ImHandler.sendTextMessage(webim.SESSION_TYPE.C2C, msg, toUserIdentifier, succ, fail);
  },

  /**
   * 发送C2C自定义消息
   */
  sendC2CCustomMessage(toUserIdentifier, msg, succ, fail) {
    ImHandler.sendCustomMsg(webim.SESSION_TYPE.C2C, msg, toUserIdentifier, succ, fail);
  },

  /**
   * 发送群文本消息
   */
  sendGroupTextMessage(msg, succ, fail) {
    ImHandler.sendTextMessage(webim.SESSION_TYPE.GROUP, msg, null, succ, fail);
  },

  /**
   * 发送群组自定义消息
   */
  sendGroupCustomMessage(msg, succ, fail, ext, setRandom = null) {
    ImHandler.sendCustomMsg(webim.SESSION_TYPE.GROUP, msg, null, succ, fail, ext, setRandom);
  },

  // 控制信令
  sendControlCustomMessage(content, userId, userNick) {
    ImHandler.sendControlCustomMessage(content, userId, userNick);
  },

  /**
   * 向信令群组发送自定义消息
   */
  sendLiveControlCustomMessage(msg, succ, fail, ext, setRandom = null) {
    ImHandler.sendLiveControlCustomMessage(webim.SESSION_TYPE.GROUP, msg, null, succ, fail, ext, setRandom);
  },
};

```



小程序音视频组件原理 在线直播/实时音视频

https://developers.weixin.qq.com/community/develop/doc/000cccb57444107426c621b1756c09
